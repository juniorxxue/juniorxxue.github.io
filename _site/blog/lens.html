<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>Snippets of Lens in Haskell | TYPES.HK</title><meta name="description" content="A minimal, text focused blog"><link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/favicon.ico" type="image/x-icon"><link href='/feed.xml' rel='alternate' type='application/atom+xml'><link rel="canonical" href="/blog/lens"><link rel="stylesheet" href="/assets/style.css"><body><main><h2 class="title">TYPES.HK</h2><nav> <a href="http://localhost:4000/">Home</a> <a href="http://localhost:4000/about">About</a> <!-- --></nav><h1>Snippets of Lens in Haskell</h1><i>Aug 16, 2023</i><h4 class="subtitle"></h4><p>Lens is a Haskell package that provides access (read, write, modify etc) into the middle of a data structure, or container.</p><div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Control.Lens</span> <span class="p">(</span> <span class="nf">lens</span><span class="p">,</span> <span class="kt">Lens</span><span class="err">'</span><span class="p">,</span> <span class="kt">Lens</span><span class="p">,</span> <span class="nf">view</span><span class="p">,</span> <span class="nf">set</span> <span class="p">)</span>
<span class="c1">-- imported from the package lens</span>

<span class="n">foo</span> <span class="o">::</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Bool</span><span class="p">))</span>
<span class="n">foo</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kt">True</span><span class="p">))</span>

<span class="c1">-- Task 1: Read the first element of foo</span>
<span class="n">read1st</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span>
<span class="n">read1st</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span>
<span class="c1">-- &gt;&gt;&gt; read1st foo</span>
<span class="c1">-- 1</span>

<span class="c1">-- Task 2: Write the 3 to the second element of foo</span>
<span class="n">write2nd</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<span class="n">write2nd</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span> <span class="n">newy</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">newy</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>

<span class="c1">-- &gt;&gt;&gt; write2nd foo 3</span>
<span class="c1">-- (1,(3,True))</span>

<span class="c1">-- Task 3: Write the False to the second element of foo</span>
<span class="n">write2ndHeter</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">d</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<span class="n">write2ndHeter</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span> <span class="n">newy</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">newy</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>

<span class="c1">-- &gt;&gt;&gt; write2ndHeter foo False</span>
<span class="c1">-- (1,(False,True))</span>

<span class="c1">-- Lens</span>

<span class="c1">-- Lens' type constructor assumes two parameters: object and focus.</span>
<span class="c1">-- to implement a lens, you need to provide a getter and a setter</span>
<span class="n">_left</span> <span class="o">::</span> <span class="kt">Lens'</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="n">a</span>
<span class="n">_left</span> <span class="o">=</span> <span class="n">lens</span> <span class="n">getter</span> <span class="n">setter</span>
  <span class="kr">where</span>
    <span class="n">getter</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span>
    <span class="n">getter</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">setter</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">setter</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="n">newx</span> <span class="o">=</span> <span class="p">(</span><span class="n">newx</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">_right</span> <span class="o">::</span> <span class="kt">Lens'</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="n">b</span>
<span class="n">_right</span> <span class="o">=</span> <span class="n">lens</span> <span class="n">getter</span> <span class="n">setter</span>
  <span class="kr">where</span>
    <span class="n">getter</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">b</span>
    <span class="n">getter</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">setter</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">setter</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="n">newy</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">newy</span><span class="p">)</span>

<span class="c1">-- use view to read, use set to write</span>
<span class="n">read1st'</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span>
<span class="n">read1st'</span> <span class="o">=</span> <span class="n">view</span> <span class="n">_left</span>
<span class="c1">-- &gt;&gt;&gt; read1st' foo</span>
<span class="c1">-- 1</span>

<span class="c1">-- you can compose (.) lens to get a new lens</span>
<span class="n">write2nd'</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<span class="n">write2nd'</span> <span class="n">obj</span> <span class="n">new</span> <span class="o">=</span> <span class="n">set</span> <span class="n">_2nd</span> <span class="n">new</span> <span class="n">obj</span>
    <span class="kr">where</span> <span class="n">_2nd</span> <span class="o">=</span> <span class="n">_right</span> <span class="o">.</span> <span class="n">_left</span>
<span class="c1">-- &gt;&gt;&gt; write2nd' foo 3</span>
<span class="c1">-- (1,(3,True))</span>

<span class="c1">-- to implement write2ndHeter, which modifies the type of the object,</span>
<span class="c1">-- we need to reach the full power of Lens.</span>
<span class="c1">-- use Lens instead of Lens'</span>
<span class="c1">-- type Lens' s a = Lens s s a a</span>
<span class="c1">-- Lens type constructor assumes four parameters:</span>
<span class="c1">-- object, new object, focus, new focus</span>

<span class="n">_left'</span> <span class="o">::</span> <span class="kt">Lens</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="n">a'</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="n">a</span> <span class="n">a'</span>
<span class="n">_left'</span> <span class="o">=</span> <span class="n">lens</span> <span class="n">getter</span> <span class="n">setter</span>
  <span class="kr">where</span>
    <span class="n">getter</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span>
    <span class="n">getter</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">setter</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a'</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">a'</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">setter</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="n">newx</span> <span class="o">=</span> <span class="p">(</span><span class="n">newx</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">_right'</span> <span class="o">::</span> <span class="kt">Lens</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b'</span><span class="p">)</span> <span class="n">b</span> <span class="n">b'</span>
<span class="n">_right'</span> <span class="o">=</span> <span class="n">lens</span> <span class="n">getter</span> <span class="n">setter</span>
  <span class="kr">where</span>
    <span class="n">getter</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">b</span>
    <span class="n">getter</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">setter</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">b'</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b'</span><span class="p">)</span>
    <span class="n">setter</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="n">newy</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">newy</span><span class="p">)</span>

<span class="n">write2ndHeter'</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">d</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<span class="n">write2ndHeter'</span> <span class="n">obj</span> <span class="n">new</span> <span class="o">=</span> <span class="n">set</span> <span class="n">_2nd</span> <span class="n">new</span> <span class="n">obj</span>
    <span class="kr">where</span> <span class="n">_2nd</span> <span class="o">=</span> <span class="n">_right'</span> <span class="o">.</span> <span class="n">_left'</span>

<span class="c1">-- &gt;&gt;&gt; write2ndHeter' foo False</span>
<span class="c1">-- (1,(False,True))</span>

<span class="n">main</span> <span class="o">::</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">putStrLn</span> <span class="s">"Hello, Lens!"</span>
</code></pre></div></div><h2 id="todo">TODO</h2><ul><li>Implementing Lens</ul></main><footer> <!--<nav class="sans"><hr> <input class="menu-btn" type="checkbox" id="menu-btn" /><p><label class="menu-icon" for="menu-btn">Menu</label></p><ul class="site-nav"><li><a href="/">Home</a><li><a href="/blog">Blog</a><li><a href="/designs">Designs</a><li><a href="/about">About</a><li><a href="https://canisee.xyz" title="Confirm your vision functionality">[Can I See]</a></ul></nav>--> <!-- <span class="mini-note">You've reached the end of the page. Good job!</span> --> <!--<nav class="sans"><hr><p><label class="menu-icon" for="menu-btn">Menu</label></p><ul class="site-nav"><li><a href="/">Home</a><li><a href="/blog">Blog</a><li><a href="/designs">Designs</a><li><a href="/about">About</a><li><a href="https://canisee.xyz" title="Confirm your vision functionality">[Can I See]</a></ul></nav>--><div class="bottom-footer"></div></footer><script> MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] } }; </script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
